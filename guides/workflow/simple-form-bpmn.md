---
category: Workflow
expires: 2020-12-31
order: 4
---
# Building a form and BPMN and deploying to COP

## Introduction

This is a guide to how to build simple forms in Form Builder, linking those forms to a BPMN, and then uploading the BPMN to COP, using the Camunda modeller.

The first form is a 'request' form, in this example a request for holiday or time off, the second form displays the data submitted in the first form and allows the approver to approve or deny the holiday request.

This guide will explain not only how to build a form but how to associate it to a BPMN and then deploy that to COP.

## Building the forms

You need to decide which components you need on your form. For this first example form there are four components:

* Disabled text box pre-populated with the user's given and family name.

* Day component capturing the holiday start date. This will be labelled 'from'.

* Day component capturing the holiday end date. This will be labelled 'to'.


![holiday request form]({{ '/images/holiday-request-form-edit.jpeg' | relative_url }})

**Figure 1. form builder edit mode**

When you preview your form in GovUK styling it will look like this.



![holiday request form GDS preview]({{ '/images/holiday-request-form-preview.jpeg' | relative_url }})

**Figure 2. holiday request form in GDS preview**

The 'holiday request workflow' has been triggered by the 'holiday request' form. Once the 'holiday request' form has been submitted, the workflow transition to the approval task, which will present the 'approval form' to the 'approver'. The 'approval form' must contain the following components:

* details of person who requested holiday.

* 'from' and 'to' dates of the holiday period requested.

![approve holiday request form]({{ '/images/approve-holiday-request-preview.jpeg' | relative_url }})

**Figure 3. approval form in form builder edit mode**

The form will be presented to the 'approver' in a prepopulated state. See Figure 4.

![approve holiday request form gds preview]({{ '/images/approve-holiday-request-gds-preview.jpeg' | relative_url }})

**Figure 4. approval form in GDS preview**

## Building the simple workflow for 'holiday request'

The workflow will be built in the Camunda modeller. Once you open the modeller you will be presented with this option ' Creat a BPMN diagram or Create a DMN diagram'. Select 'BPMN diagram'. See Figure 4.

![camunda modeller options]({{ '/images/camunda-modeller-options.jpeg' | relative_url }})

**Figure 4. camunda modeller options**

You will then be presented with the process properties panel. See Figure 5. It is important you provide the role in the candidate starter groups or you won't see it appear in the UI. Once the process has been started with the candidate group if you don't have that role you will never see the process. So for example if your manager or approver doesn't have the same role they will not see the approval task.


![process properties panel]({{ '/images/process-properties-panel.jpeg' | relative_url }})

**Figure 5. process properties panel with properties completed**

### How to add the first form - 'holiday request'

The modeller automatically provides a start event and the properties panel. Select the start event notation (Fig. 6.)

![start event notation]({{ '/images/start-event-notation.jpeg' | relative_url }})

**Figure 6. start event notation**

Next fill in the 'Id' and 'Name' boxes. The 'Id' is useful for writing unit tests because you can reference activities by the id. If it's an autogenerated id it's difficult to remember or know what they are. The 'Name' box should correspond to the label on the start node. Click on the 'Forms' tab. In the 'Form Key' box is where you put the name of the form. This will be used by the UI to load the form.


### How to add the 'Approver form'


Next create the 'approval task'. Select 'Create Task' icon on the palette or click on the start node and then select the 'Append Task' icon. Once you click on it, give the task a name typed into the box. Always use a verb. A task should always be an action. In this example use 'Approve holiday request'. This task then needs to be converted to a specific type. Click on the 'change type' spanner icon. A drop down list will appear. Select 'User Task' (see Figure 7.)

![change type drop down list]({{ '/images/change-type-drop-down-list.jpeg' | relative_url }})

**Figure 7. 'Change type' drop down list**

The tab for the 'User task' appears. In the Id box fill in a descriptive Id that will be easy to remember. In 'Details' section there are three pieces of information that need to be complete. First you need to decide who the form will go to. You can assign the form to an individual, a candidate group/team. The individual can be static, i.e. a specifically identified individual, or dynamic, i.e. a value that's derived from the form.

If you want to assign it to an individual, but one that is dynamically provided by the form then input the following variable expression

 ```
 ${S(holidayRequest).prop('approverEmail').stringValue()}
 ```

 This expression

 ```
 ${S(holidayRequest)
   ```
   references the variable 'holidayRequest' which contains the data that's been submitted.

   ```
   .prop('approverEmail').stringValue()}
   ```
  Inside the object is a property called 'approverEmail' and I want the value of that i.e. the email address of the individual who needs to approve the form. [For more info on spin](https://docs.camunda.org/manual/latest/reference/spin/json/01-reading-json/)

The form can also be assigned to a group. In 'Candidate Groups' box use almost the same expression except the property will be e.g. 'approver Team' rather than 'approver Email'

```
${S(holidayRequest).prop('approverTeam').stringValue()}
```
The 'approver Team' can be a comma separated string. Camunda will automatically covert that into a list.

If your task requires a due date, for example if you want to use due dates to order tasks in the COP task list, then fill in the due date box. If you use a dynamic expression then the due date will be created when the task is created. This is the dynamic expression to use.

```
${now()}
```
You also need to fill a description in the 'Description' box so that the Task View will explain the nature of the task.

Now we want to present a form to the 'approver'. Do this by clicking on the 'Form' tab. Copy the name of the 'approve holiday request' form and put it in the 'Form Key' box.

![approve request form key]({{ '/images/approve-holiday-request-form-key.jpeg' | relative_url }})

**Figure 8. approve request form key**

Now finish the BPMN by attaching an 'End Event'. Follow the same process. First give it an Id. Give it a name to represent that the process is complete e.g. 'Request approved'.

### How to deploy the BPMN to COP

Next save the file in the appropriate repository, please consult your developer/tech arch. If you are testing this locally you can save it in your local directory.

Then click on the arrow button at the end of the toolbar 'Deploy Current Diagram'. Give the diagram a name e.g. 'Holiday Request' then the url of the workflow engine that's running.

![deploy to cop]({{ '/images/deploy-to-cop.jpeg' | relative_url }})

**Figure 9. Deploy to COP**
